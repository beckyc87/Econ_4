---
title: "Econ Assignment 4 Carbon"
author: "Becky Clow"
date: "5/29/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Load packages
```{r}

library(tidyverse)
library(reshape2)

carbon_abate <- read_csv("HW4Data.csv")

```

#Visualize raw data
```{r}
#Marginal cost of abatement scatter plots
sector_A <- ggplot(carbon_abate, aes(x = Abatement, y = MC_A)) +
  geom_point()
sector_A

sector_B <- ggplot(carbon_abate, aes(x = Abatement, y = MC_B)) +
  geom_point()
sector_B

sector_C <- ggplot(carbon_abate, aes(x = Abatement, y = MC_C)) +
  geom_point()
sector_C

sector_D <- ggplot(carbon_abate, aes(x = Abatement, y = MC_D)) +
  geom_point()
sector_D

```


#Question 1. 
Write down a plausible functional form for the marginal cost of abatement for sector A. Use regression analysis to estimate the parameters of that function. Repeating this for sectors B, C, and D will give you a model of the marginal cost of abatement function for each sector. How well do your models fit the data for each sector? You may need to experiment with different functional forms. Produce a plot of the estimated marginal abatement cost functions in all four sectors (this plot should go in your memo).

## 1) Choose a functional form 
Answer: Linear regression bc fuckkkk that shit

## 2) Determine marginal cost of abatement functions for each sector
```{r}

#MC Linear regressions
model_A <- lm(MC_A ~ Abatement, data = carbon_abate)
summary(model_A)

model_B <- lm(MC_B ~ Abatement, data = carbon_abate)
summary(model_B)

model_C <- lm(MC_C ~ Abatement, data = carbon_abate)
summary(model_C)

model_D <- lm(MC_D ~ Abatement, data = carbon_abate)
summary(model_D)

#MC Functions 
MC_A_fxn <- function(Q) {(model_A$coefficients[2])*Q + model_A$coefficients[1]}
MC_B_fxn <- function(Q) {(model_B$coefficients[2])*Q + model_B$coefficients[1]}
MC_C_fxn <- function(Q) {(model_C$coefficients[2])*Q + model_C$coefficients[1]}
MC_D_fxn <- function(Q) {(model_D$coefficients[2])*Q + model_D$coefficients[1]}
```

## 3) How well does your model fit the data?
Answer: Close enough bitch

## 4) Produce a plot of the marginal abatement cost functions for all four sectors
```{r}

#MC graph
MC_graph <- ggplot(data.frame(x=c(1, 250)), aes(x=x)) + 
  stat_function(fun = MC_A_fxn, geom = "line", aes(color="A")) + 
  stat_function(fun = MC_B_fxn, geom = "line", aes(color="B")) + 
  stat_function(fun = MC_C_fxn, geom = "line", aes(color="C")) + 
  stat_function(fun = MC_D_fxn, geom = "line", aes(color="D")) + 
  xlab("Carbon emissions (tons)") + 
  ylab("Price ($/ton)") +
  scale_x_continuous(expand = c(0,0), limits = c(0,250))+
  scale_y_continuous(expand = c(0,0), limits = c(0,200))+ 
  scale_color_manual(values = c(A="red", B="blue", C="green", D="purple"), name = "Sector")+
  theme_classic() 
MC_graph


## **To do: Color code the lines and/or add a legend
```



# Question 2.
Using these models and the current level of carbon emissions, derive each sector’s demand curve for carbon emissions. In other words, how much would each sector be willing to pay for the right to pollute the first unit, second unit, etc? Draw these demand curves on a graph. Which sector is willing to pay the most for the first unit of carbon emissions?

## 1) Demand curves for carbon emissions for each sector
```{r}
#Set initial emissions
Q_A_initial <- 180
Q_B_initial <- 200
Q_C_initial <- 220
Q_D_initial <- 300


#Price for each sector at their initial Q (i.e. the y intercept of the demand function)
demand_A_int <- (model_A$coefficients[1] + model_A$coefficients[2]*Q_A_initial)
demand_A_int #95.18706 

demand_B_int <- (model_B$coefficients[1] + model_B$coefficients[2]*Q_B_initial)
demand_B_int #49.06656 

demand_C_int <- (model_C$coefficients[1] + model_C$coefficients[2]*Q_C_initial)
demand_C_int #160.7868 

demand_D_int <- (model_D$coefficients[1] + model_D$coefficients[2]*Q_D_initial)
demand_D_int #87.66577 


#Slope of the demand function for each sector
demand_A_slope <- (demand_A_int/-Q_A_initial)
demand_A_slope # -0.528817 

demand_B_slope <- (demand_B_int/-Q_B_initial)
demand_B_slope # -0.2453328 

demand_C_slope <- (demand_C_int/-Q_C_initial)
demand_C_slope # -0.7308492 

demand_D_slope <- (demand_D_int/-Q_D_initial)
demand_D_slope # -0.2922192 


#Final demand functions (price = slope*Q + intercept)
demand_A_fxn <- function(Q) {demand_A_slope*Q + demand_A_int}
demand_B_fxn <- function(Q) {demand_B_slope*Q + demand_B_int}
demand_C_fxn <- function(Q) {demand_C_slope*Q + demand_C_int}
demand_D_fxn <- function(Q) {demand_D_slope*Q + demand_D_int}


```

## 2) Graph of the demand curves
```{r}
#Demand graph
demand_graph <- ggplot(data.frame(x=c(1, 250)), aes(x=x)) + 
  stat_function(fun = demand_A_fxn, geom = "line", aes(color="A")) + 
  stat_function(fun = demand_B_fxn, geom = "line", aes(color="B")) + 
  stat_function(fun = demand_C_fxn, geom = "line", aes(color="C")) + 
  stat_function(fun = demand_D_fxn, geom = "line", aes(color="A")) + 
  xlab("Carbon emissions (tons)") + 
  ylab("Price ($/ton)") +
  scale_x_continuous(expand = c(0,0), limits = c(0,250))+
  scale_y_continuous(expand = c(0,0), limits = c(0,200))+
  theme_classic() +
  scale_color_manual(values = c(A="red", B="blue", C="green", D="purple"), name = "Sector")
demand_graph

# **To do: Color code the lines and/or add legend

```

## 3) Which sector is willing to pay the most for the first unit of carbon emissions?
Answer: 

---------------------------------------------

#Question 3.
Now focus on country X (which contains sectors A, B, and C). Assume there are no “co-benefits” from carbon abatement (i.e. that there are no local pollutants that are affected by carbon abatement). Suppose to meet the Paris Accord commitments, country X needs to cut all carbon emissions in half. For each of the policy options listed below, derive: 
(1) The cost (or benefit) to each sector
(2) The total cost of meeting the target in country X 
(3) The tax revenue generated

    
# A. Carbon cap
Each sector (A, B, and C) must cut its carbon emissions by 100 tons (thus reducing total emissions from 600 down to 300).

A: 180 tons --> 80 tons
B: 200 tons --> 100 tons
C: 220 tons --> 120 tons

## (1) The cost (or benefit) to each sector
```{r}
#Sector cost
cost_A_cap <- integrate(demand_A_fxn, 80, Q_A_initial)
cost_A_cap # 2644.085

cost_B_cap <- integrate(demand_B_fxn, 100, Q_B_initial)
cost_B_cap # 1226.664

cost_C_cap <- integrate(demand_C_fxn, 120, Q_C_initial)
cost_C_cap # 3654.246

```

## (2) The total cost of meeting the target in country X 
```{r}
#Total cost
cost_total_cap <- cost_A_cap[["value"]] + cost_B_cap[["value"]] + cost_C_cap[["value"]]
cost_total_cap # 7524.995

#Total cost of the carbon cap policy is $7524.995

```

## (3) Tax revenue generated
```{r}

#Total tax revenue = $0 
```




# B. Carbon tax
To emit a ton of carbon in country X, you must pay a tax of $t. Find the tax that accomplishes the desired reduction.


## (1) The cost (or benefit) to each sector
```{r}

#Define the coefficients
MC_A_slope <- model_A$coefficients[2]
MC_B_slope <- model_B$coefficients[2]
MC_C_slope <- model_C$coefficients[2]

MC_A_int <- model_A$coefficients[1]
MC_B_int <- model_B$coefficients[1]
MC_C_int <- model_C$coefficients[1]

#Create an aggregate marginal cost function
MC_agg_fxn <- function(Q) {(Q + (MC_A_int/MC_A_slope) + (MC_B_int/MC_B_slope) + (MC_C_int/MC_C_slope)) / ((1/MC_A_slope) + (1/MC_B_slope) + (1/MC_C_slope))}

tax <- MC_agg_fxn(300)
tax #39.42658 

#MC solved for price to calculate the quantitiy Carbon emitted with tax price
A_MC_P <- function(P) {(P - model_A$coefficients[1]) / model_A$coefficients[2]}
B_MC_P <- function(P) {(P - model_B$coefficients[1]) / model_B$coefficients[2]}
C_MC_P <- function(P) {(P - model_C$coefficients[1]) / model_C$coefficients[2]}
D_MC_P <- function(P) {(P - model_D$coefficients[1]) / model_D$coefficients[2]}

#carbon emitted per sector with tax
Q_A_tax <- A_MC_P(tax)
Q_B_tax <- B_MC_P(tax)
Q_C_tax <- C_MC_P(tax)

Q_A_tax #83.33489 tons carbon
Q_B_tax #151.4956 tons carbon
Q_C_tax #65.16953 tons carbon

Q_total_tx <- Q_A_tax + Q_B_tax + Q_C_tax
Q_total_tx

#Cost to each sector

```

## (2) The total cost of meeting the target in country X 
```{r}


```

## (3) Tax revenue generated
```{r}


```

```{r}
A_demand_X <- function(y) {(y - A_demand_int) / A_slope}

B_demand_X <- function(y) {(y - B_demand_int) / B_slope}

C_demand_X <- function(y) {(y - C_demand_int) / C_slope}

agg_demand_X <- function(y) {((y - A_demand_int) / A_slope) + ((y - B_demand_int) / B_slope) + ((y - C_demand_int) / C_slope)}

A_slope
A_demand_int
B_slope
B_demand_int
C_slope
C_demand_int

agg_demand_X(0)

# x = (y-95.18706) / -0.528817) + ((y-49.06656 ) / -0.2453328 ) + ((y-160.7868 ) / -0.7308492 )

agg_demand <- function(x) {(-0.09482*x - 56.89054) / 0.69552}
## double check this algebra ^^

agg_graph <- ggplot(data.frame(x=c(1, 200)), aes(x=x)) + 
  stat_function(fun = agg_demand, geom = "line") + 
  xlab("x") + 
  ylab("y") +
  scale_x_continuous(expand = c(0,0), limits = c(0,200))
agg_graph
```

# tax using marginal cost curve
```{r}

#supply curve functions solved for y, gives the price



#supply curve function solved for x, gives the quantity
MC_A_Qfxn <- function(P) {(P - model_A$coefficients[1]) / model_A$coefficients[2]}

MC_B_Qfxn <- function(P) {(P - model_B$coefficients[1]) / model_B$coefficients[2]}

MC_C_Qfxn <- function(P) {(P - model_C$coefficients[1]) / model_C$coefficients[2]}

MC_D_Qfxn <- function(P) {(P - model_D$coefficients[1]) / model_D$coefficients[2]}

#aggregate supply curve

#may be more difficult then necessary
agg_supply_x <- function(y) {((y - model_A$coefficients[1]) / model_A$coefficients[2]) + ((y - model_B$coefficients[1]) / model_B$coefficients[2]) + ((y - model_C$coefficients[1]) / model_C$coefficients[2])}

#Madelines code pulling from
#Mag =(1/sectorA$coefficients[2])+(1/sectorB$coefficients[2])+(1/sectorC$coefficients[2])
#Bag = (-(sectorA$coefficients[1]/sectorA$coefficients[2])-(sectorB$coefficients[1]/sectorB$coefficients[2])-(sectorC$coefficients[1]/sectorC$coefficients[2]))



agg_slope_supply <- (1/model_A$coefficients[2]) + (1/model_B$coefficients[2]) + (1/model_C$coefficients[2])
agg_intercept_supply <- (-(model_A$coefficients[1]/model_A$coefficients[2]) - (model_B$coefficients[1]/model_B$coefficients[2]) - (model_C$coefficients[1]/model_C$coefficients[2]))

# Price = (quantity + intercept) / slope

agg_supply <- function(x) {(x + agg_intercept_supply) / agg_slope_supply}
tax <- agg_supply(300)
tax #35.19137



```



# C. Cap and trade
Each sector (A, B, C) is allocated carbon permits equal to their current emissions minus 100 (same as in (a) above), thus achieving the total reduction of 300. Then, these three sectors are allowed to trade with each other. You will need to derive the outcome of that trading.
```{r}
#same emission and cost as tax

```
   
    
    
4. Again, without any co-benefits, suppose that country Y (which only has one carbon-emitting sector, D) has no obligation to reduce its emissions. Country X asks country Y to enter the country X carbon market. Doing so would require country Y to put a cap on carbon emissions at its current level of emissions (300 tons), but would then allow country Y to sell carbon offsets to sectors A, B, or C. Are there any incentives for country Y to enter country X’s carbon market and to thus place a voluntary cap on its emissions? Are there any incentives for country X to try to attract country Y into its market?

```{r}



```



5. Now assume that every ton of carbon emissions creates 1 ton of local air pollution. Local air pollution causes economic damages (health, environmental, etc.), but only in the country in which it is emitted. Assume there are no local air pollution regulations in either country X or country Y.

    a. In a carbon cap and trade market that only covers sectors in country X, how much local air pollution would you expect in country X? In country Y?
    
```{r}
#country X tons of air pollution is equal to the amount of carbon emitted
country_x_pollution <- Q_A_tax + Q_B_tax + Q_C_tax
country_x_pollution #300 tons air pollution in country x

country_y_pollution <- 300 # tons air pollution = normal emissions

```

    b. If country Y enters the carbon market for country X (as in question 4 above), how much local pollution will there be in country X and country Y?
    
```{r}



```

    c. What advice can you give country X and country Y about the desirability of allowing international trade of carbon emissions credits?
    
```{r}



```

    
    